{% extends 'base.html.twig' %}

{% block title %}Hello {{ controller_name }}!{% endblock %}

{% block body %}
    <div class="example-wrapper">
        <h1>Hello {{ controller_name }}! âœ…</h1>
        <a href="{{ path('about') }}">{{ 'global.about'|trans }}</a>
        {% if app.user %}
            {{ 'global.favorites'|trans }} {{ 'of'|trans }} {{ app.user.username }}
            <ul>
                {% for favorite in favorites %}
                    <li>
                        {% set authors = favorite.fiction.authors %}
                        {% set fiction = favorite.fiction %}
                        {{ fiction.title }} (<small>{{ fiction.averageRating ?
                            'fiction.ratings.average'|trans({"{averageRating}": fiction.averageRating})|raw :
                            'fiction.ratings.empty'|trans|raw }}</small>)
                        ({% for author in authors %}{{ author.username }}{{ not loop.last ? ', ' }}{% endfor %})<br/>
                        <small>{{ 'fiction.favorites.added'|trans }} {{ favorite.favoritedAt|localizeddate }}</small>
                        <h3>{{ 'global.chapters'|transchoice(fiction.chapters.count) }}</h3>
                        <ul>
                            {% for chapter in fiction.chapters %}
                                <li>
                                    {{ chapter.title }}
                                    ({% for author in chapter.authors %}{{ author.username }}{{ not loop.last ? ', ' }}{% endfor %})
                                </li>
                            {% endfor %}
                        </ul>
                        <h3>{{ 'global.comments'|transchoice(fiction.comments.count) }}</h3>
                        {% dump favoritesProps %}
                        {#<user-favorites data-favorites="{{ favoritesProps|e('html_attr') }}"></user-favorites>#}
                        {% embed 'partials/_comments.html.twig' with {'comments': fiction.rootComments} %}{% endembed %}
                    </li>
                {% endfor %}
            </ul>
        {% endif %}

    </div>
{% endblock %}